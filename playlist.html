<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MoodMelody</title>
  <script>
    const twinwordApiKey = "151c80fd18msh6bc1208d6296b6ep1b10b8jsna5e668379b92";

    async function generateCombinedPlaylist() {
      const moodInput = document.getElementById("moodText").value.trim();
      const genreInput = document.getElementById("genreSelect").value;

      if (!moodInput && !genreInput) {
        alert("Please enter a mood or pick a genre.");
        return;
      }

      let moodTag = null;

      if (moodInput) {
        try {
          const res = await fetch("https://twinword-sentiment-analysis.p.rapidapi.com/analyze/", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
              "X-RapidAPI-Key": twinwordApiKey,
              "X-RapidAPI-Host": "twinword-sentiment-analysis.p.rapidapi.com"
            },
            body: new URLSearchParams({ text: moodInput })
          });

          const data = await res.json();
          const sentiment = data.type?.toLowerCase();

          const tagMap = {
            positive: "happy",
            negative: "sad",
            neutral: "chill"
          };

          moodTag = tagMap[sentiment] || null;
        } catch (err) {
          console.error("Error with sentiment API:", err);
        }
      }

      if (moodTag) localStorage.setItem("moodTag", moodTag);
      if (genreInput) localStorage.setItem("genreTag", genreInput);

      window.location.href = "playlist.html";
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-yellow-100 min-h-screen flex flex-col items-center justify-center p-8">
  <h1 class="text-4xl font-bold text-red-600 mb-6">ðŸŽµ MoodMelody ðŸŽµ</h1>

  <div class="w-full max-w-md bg-white p-6 rounded-xl shadow-md space-y-6">
    <div>
      <label for="moodText" class="block text-lg font-medium text-gray-700 mb-2">Describe your mood:</label>
      <input id="moodText" type="text" placeholder="e.g., I feel motivated and excited"
             class="w-full p-2 border border-gray-300 rounded"/>
    </div>

    <div>
      <label for="genreSelect" class="block text-lg font-medium text-gray-700 mb-2">Optional: Pick a genre</label>
      <select id="genreSelect" class="w-full p-2 border border-gray-300 rounded">
        <option value="">-- None selected --</option>
        <option value="pop">Pop</option>
        <option value="rock">Rock</option>
        <option value="lofi">Lofi</option>
        <option value="metal">Metal</option>
        <option value="classical">Classical</option>
        <option value="sad">Sad</option>
        <option value="happy">Happy</option>
        <option value="chill">Chill</option>
        <option value="experimental">Experimental</option>
      </select>
    </div>

    <button onclick="generateCombinedPlaylist()"
            class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600">
      Generate Playlist ðŸŽ§
    </button>
  </div>
</body>
</html>
