<script>
  const twinwordApiKey = "151c80fd18msh6bc1208d6296b6ep1b10b8jsna5e668379b92";

  async function generatePlaylist() {
    const moodInput = document.getElementById("moodText").value.trim();
    if (!moodInput) {
      alert("Please describe how you're feeling.");
      return;
    }

    try {
      const res = await fetch("https://twinword-sentiment-analysis.p.rapidapi.com/analyze/", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
          "X-RapidAPI-Key": twinwordApiKey,
          "X-RapidAPI-Host": "twinword-sentiment-analysis.p.rapidapi.com"
        },
        body: new URLSearchParams({ text: moodInput })
      });

      const data = await res.json();
      console.log("‚úÖ Sentiment API response:", data);

      if (!data || !data.type) {
        alert("‚ùå Could not detect sentiment.");
        return;
      }

      const sentiment = data.type.toLowerCase(); // "positive", "negative", or "neutral"

      // Map sentiment to music tag
      const tagMap = {
        positive: "happy",
        negative: "sad",
        neutral: "chill"
      };

      const musicTag = tagMap[sentiment] || "mood";
      console.log("üéØ Sentiment:", sentiment, "‚Üí Music tag:", musicTag);

      localStorage.setItem("userMood", musicTag);
      window.location.href = "playlist.html";

    } catch (err) {
      console.error("‚ùå Sentiment API call failed:", err);
      alert("‚ùå API error ‚Äì check the console for details.");
    }
  }
</script>
